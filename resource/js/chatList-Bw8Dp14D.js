import{s as e,Y as t,t as s,q as i,Z as a,b as l}from"./index-30tzVDQE.js";import{_ as o}from"./Btn-BQ5zHeyl.js";import{_ as c}from"./ScrollView-DaG0IhIx.js";import{s as n,y as d,d as r,a0 as u,H as p,b as v,I as m,G as g,e as h,g as f,B as y,m as k,F as _,S as b,Y as C,o as L,n as w,i as I,t as q,p as x,j as M,a as T,l as z,q as D,v as H,_ as R,$ as S}from"./vue-DH2RNpQ3.js";import{_ as G}from"./groups_setting-bLtMNASU.js";import{I as $,p as U}from"./index-BWvB_AgY.js";const j=n({ChatGroupListReq:"",Input:null,per_page:50,page:1,groupChatitemList:[],groupItem:""}),V=e=>(R("data-v-1da6c0d2"),e=e(),S(),e),E={class:"chat_list"},O={class:"head"},P=V((()=>f("span",null,"聊天列表("+q(6)+")",-1))),A={class:"section"},F={class:"groups"},Y={class:"groups_tabs"},B=["onClick"],J={class:"group_setting"},N={class:"query"},K=V((()=>f("iconpark-icon",{"icon-id":"majesticonssearch-line",size:"1.2rem",class:"refresh"},null,-1))),W={class:"list"},Z=["onClick"],Q={class:"left"},X={class:"img"},ee=["src"],te={key:0,class:"msg_number"},se={class:"name_type"},ie={class:"name"},ae={key:0,class:"right"},le={class:"time"},oe={class:"msg"},ce={key:1,class:"right"},ne={key:0,class:"pin_line"},de={key:0,class:"group_list_setting popup_body"},re={class:"title"},ue={class:"group_list"},pe={class:"left"},ve=V((()=>f("img",{src:"/imgs/serviceModal/group_item.webp",alt:""},null,-1))),me={class:"item_title"},ge=["onClick"],he={class:"submit_btn"},fe=V((()=>f("iconpark-icon",{"icon-id":"tongyicontjyhk",size:"1.2rem",class:"add"},null,-1))),ye={key:1,class:"add_group popup_body"},ke={class:"content"},_e=V((()=>f("div",{class:"info"},"分组名称:",-1))),be=V((()=>f("div",{class:"info"},"包括的对话:",-1))),Ce=[V((()=>f("iconpark-icon",{"icon-id":"dibultktxs04",size:"1.2rem",class:"add"},null,-1))),V((()=>f("div",{class:"text"},"添加对话",-1)))],Le={class:"add_chatlist"},we={class:"item"},Ie=["src"],qe={class:"name"},xe=["onClick"],Me={class:"submit_btn"},Te={key:2,class:"add_group popup_body"},ze={class:"content"},De=V((()=>f("iconpark-icon",{"icon-id":"majesticonssearch-line",size:"1.2rem",class:"refresh"},null,-1))),He={class:"add_chatlist"},Re=["onClick"],Se={class:"item"},Ge=["src"],$e={class:"name"},Ue={class:"submit_btn"},je=["onClick"],Ve={class:"title"},Ee=["icon-id"],Oe={class:"show_group_list"},Pe=["onClick"],Ae=l(r({__name:"chatList",setup(l){const r=u(),R={"-1":"上级代理",1:"下级代理",0:"官方客服"},S=n({routeName:"chatList",root:null,deviceID:2654917,requestid:5e3,todeviceid:2655337,chatitemList:[],groupList:[]}),{getChatlist:V,getChatMsg13:Ae,groupChatitemList:Fe,getChatMsg24:Ye,getChatMsg12:Be,getListGroup:Je,encodeParams:Ne,encodeInput:Ke,decodeContent:We,editchat:Ze}=(e=>{const t=(t,s)=>{let i=e.root.lookupType(s);const a=new Uint8Array(t),l=i.decode(a);return i.toObject(l)},s=()=>{const t=e.root.lookupType("KfRoleIdGetReq");e.requestid++;const s=e.requestid;var a={deviceid:e.deviceID};const l=t.verify(a);if(l)throw new Error(l);const o=t.encode(t.create(a)).finish(),c=i(24,s,o);$.sendMessageHandler(c)},i=(t,s,i)=>{j.Input=e.root.lookupType("Input");const a={type:t,requestid:s,data:i},l=j.Input.verify(a);if(l)throw new Error(l);const o=j.Input.create(a);return j.Input.encode(o).finish()},a=(t,s)=>{let i=e.root.lookupType(s);const a=i.verify(t);if(a)throw new Error(a);const l=i.create(t);return i.encode(l).finish()};return{...d(j),getChatlist:t=>{e.chatitemList=[],j.ChatGroupListReq=e.root.lookupType("ChatGroupListReq"),e.requestid++;const s=e.requestid;var a={deviceid:e.deviceID,groupid:t?t.id:0,page:1,pagesize:1e3};j.groupItem=t;const l=j.ChatGroupListReq.verify(a);if(l)throw new Error(l);const o=j.ChatGroupListReq.encode(j.ChatGroupListReq.create(a)).finish(),c=i(13,s,o);$.sendMessageHandler(c)},getChatMsg13:i=>{if(i.data){const a=t(i.data,"GroupChatListRsp");j.groupItem&&j.groupItem.id?(j.groupChatitemList=a.chatitem,console.log("groupItem获取的聊天列表",e.chatitemList)):e.chatitemList=a.chatitem,1!=e.chatitemList[0]?.iskf&&s()}else s()},getChatMsg24:t=>{const s=e.root.lookupType("UserRole"),i=new Uint8Array(t.data),a=s.decode(i),l=s.toObject(a),o={THeadPhoto:"1001",TUsername:l.username,Tdeviceid:l.roleid,chatid:"",deep:0,deviceid:e.deviceID,id:99999};e.chatitemList.unshift(o),console.log("聊天列表加上客服",e.chatitemList)},getDateFromat:()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`},synchistorymsg:()=>{e.requestid++;const t=e.requestid;var s={chatid:e.deviceID>e.todeviceid?e.deviceID+"-"+e.todeviceid:e.todeviceid+"-"+e.deviceID,perpage:j.per_page,page:1};console.log("synchistorymsg",s);const a=e.root.lookupType("SyncHistoryInput");j.page++;const l=a.verify(s);if(l)throw new Error(l);const o=a.encode(a.create(s)).finish(),c=i(8,t,o);$.sendMessageHandler(c)},getListGroup:()=>{e.requestid++;const t=e.requestid;var s={deviceid:e.deviceID,page:1,pagesize:100};const a=e.root.lookupType("GroupListReq"),l=a.encode(a.create(s)).finish(),o=i(12,t,l);$.sendMessageHandler(o)},getChatMsg12:s=>{const i=t(s.data,"GroupListRsp");console.log("分组列表",i),e.groupList=i.groupitem},encodeParams:a,encodeInput:i,decodeContent:t,editchat:t=>{const s=e.requestid;var l={id:t.id,deviceid:e.deviceID,chatgroupid:t.groupid||0,sort:t.sort,istop:t.istop,enableflag:t.enableflag};console.log("editchat params",l);const o=a(l,"ChatItemModifyReq"),c=i(14,s,o);$.sendMessageHandler(c)}}})(S),Qe=async t=>{const s=We(t,"Output");if(console.log("onMessage/Output output0 ",s),s.code>1e4)alert(s.message);else switch(s.type){case 13:Ae(s);break;case 9:case 11:tt(0),e.text("操作成功");break;case 12:Be(s);break;case 24:Ye(s);break;case 14:V(),e.text("操作成功"),bt()}},Xe=p("");let et=p(0);const tt=(e,t)=>{et.value=e,V(t)},st=v((()=>{if(!Xe.value)return S.chatitemList;let e=S.chatitemList.filter((e=>-1!=e.TUsername.indexOf(Xe.value)));return console.log("chatitemList1",e),e})),it=p(!1),at=p(""),lt=p(""),ot=p(1),ct=p(Fe||[]),nt=()=>{ot.value=2,lt.value="",Fe.value=[]},dt=()=>{ot.value=1},rt=()=>{ot.value=3,ct.value=[]},ut=()=>{ot.value=2,ct.value=[]},pt=e=>ct.value.find((t=>t.id===e.id)),vt=()=>{S.requestid++;const e=S.requestid;var t={deviceid:S.deviceID,sort:1,istop:2,name:lt.value};const s=Ne(t,"ChatGroupModifyReq"),i=Ke(9,e,s);$.sendMessageHandler(i),it.value=!1},mt=p(!1),gt=p(0),ht=p(!1),ft=({index:e})=>{console.log("handleClick",e),ht.value=!0,mt.value=!0,gt.value=e,setTimeout((()=>{ht.value=!1}),100)},yt=v((()=>(console.log(1211,S.chatitemList),[{title:1===S.chatitemList[gt.value]?.istop?"取消置顶":"置顶",icon:"tanchuzwpy01"},{title:!0===S.chatitemList[gt.value]?.readed?"未读":"已读",icon:"tanchuzwpy02"},{title:!0===S.chatitemList[gt.value]?.enableflag?"解除屏蔽":"屏蔽",icon:"tanchuzwpy03"},{title:"移动到分组",icon:"tanchuzwpy04"}]))),kt=p(0),_t=p(!1),bt=()=>{_t.value=!1,mt.value=!1};return m((async()=>{document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",$.conectWebsocket(),S.root=await U.load("/connect.ext.proto"),(()=>{const e={deviceid:S.deviceID,userid:S.deviceID,token:"mmssdfasd1155"},t=Ne(e,"SignInInput"),s=Ne({type:1,requestid:5e3,data:t},"Input");$.sendMessageHandler(s)})(),$.resgisterHandler(Qe),Je(),V()})),g((()=>{document.documentElement.style.overflow="visible",document.body.style.overflow="visible"})),(e,l)=>{const n=t,d=c,u=s,p=o,v=i,m=a,g=C("longpress"),U=C("shrink-on-click");return L(),h("div",E,[f("div",O,[y(n,{class:"navbar","z-index":"5",clickable:!1,fixed:"","safe-area-inset-top":""},{content:k((()=>[P])),left:k((()=>[f("iconpark-icon",{onClick:l[0]||(l[0]=t=>e.$router.go(-1)),class:"close","icon-id":"tongyicontyfanh",size:"2.4rem"})])),right:k((()=>[f("iconpark-icon",{onClick:l[1]||(l[1]=t=>e.$router.push("/friendsList")),class:"close","icon-id":"liaotlbren",size:"1.5rem"})])),_:1})]),f("div",A,[f("div",F,[f("div",Y,[y(d,{class:"scroll-view","scroll-x":!0,style:{width:"100%","white-space":"nowrap",display:"flex"}},{default:k((()=>[f("view",{class:w(["item",0==I(et)?"active":""]),onClick:l[2]||(l[2]=e=>tt(0))}," 全部 ",2),(L(!0),h(_,null,b(S.groupList,((e,t)=>(L(),h("view",{class:w(["item",I(et)==t+1?"active":""]),key:t,onClick:s=>tt(t+1,e)},q(e.name),11,B)))),128))])),_:1})]),f("div",J,[f("img",{class:"item_img",src:G,alt:"",onClick:l[3]||(l[3]=e=>it.value=!it.value)})])]),f("div",N,[y(u,{modelValue:Xe.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Xe.value=e),placeholder:"点击查找聊天列表"},{left:k((()=>[K])),_:1},8,["modelValue"])]),f("div",W,[(L(!0),h(_,null,b(st.value,((e,t)=>(L(),h(_,{key:t},[x((L(),h("div",{class:w(["list_item",[gt.value==t&&mt.value?"active":"",e.deep?"":"guanfang_kefu"]]),onClick:t=>((e,t)=>{mt.value||r.push({path:"/chatRoom",query:{userInfo:JSON.stringify(e)||"",type:t,requestid:S.requestid}})})(e,R[""+e.deep])},[f("div",Q,[f("div",X,[f("img",{class:"item_img",src:`/imgs/head_icons/${e.THeadPhoto}.webp`,alt:""},null,8,ee),e.unreadnums?(L(),h("div",te,q(e.unreadnums),1)):M("",!0)]),f("div",se,[f("div",ie,q(e.TUsername),1),f("div",{class:w(["indent_type",["type"+e.deep]])},q(R[""+e.deep]),3)])]),e.deep?(L(),h("div",ae,[f("div",le,q(e.updatetime),1),f("div",oe,q(e.msg),1)])):(L(),h("div",ce,"点击咨询客服"))],10,Z)),[[g,{handler:ft,params:{item:e,index:t}}]]),e.deep?M("",!0):(L(),h("div",ne))],64)))),128))])]),y(v,{visible:it.value,"onUpdate:visible":l[8]||(l[8]=e=>it.value=e),title:e.$t("分组管理")},{default:k((()=>[1==ot.value?(L(),h("div",de,[f("div",re,q(e.$t("将不同对话归纳分类，并在它们之间快速切换。")),1),f("div",ue,[(L(!0),h(_,null,b(S.groupList,((e,t)=>(L(),h("div",{class:"group_item",key:t},[f("div",pe,[ve,f("div",me,q(e.name),1)]),f("iconpark-icon",{"icon-id":"fenzshanxin01",size:"1.2rem",class:"delete",onClick:t=>(e=>{const t=S.requestid;var s={deviceid:S.deviceID,id:e.id,sort:0,istop:0,name:""};const i=Ne(s,"ChatGroupModifyReq"),a=Ke(11,t,i);$.sendMessageHandler(a)})(e)},null,8,ge)])))),128))]),f("div",he,[f("div",{height:"44px",width:"200px",class:"submit",onClick:nt},[fe,f("span",null,q(e.$t("新建分组")),1)])])])):2==ot.value?(L(),h("div",ye,[f("div",ke,[_e,y(u,{type:"number",clearable:"",size:"large",modelValue:lt.value,"onUpdate:modelValue":l[5]||(l[5]=e=>lt.value=e),placeholder:"请输入新建分组名称"},null,8,["modelValue"]),be,f("div",{class:"add_chat",onClick:rt},Ce),f("div",Le,[(L(!0),h(_,null,b(ct.value,((e,t)=>(L(),h("div",{class:"chatlist",key:t},[f("div",we,[f("img",{class:"item_img",src:`/imgs/head_icons/${e.THeadPhoto}.webp`,alt:""},null,8,Ie),f("div",qe,q(e.TUsername),1),f("div",{class:w(["indent_type",["type"+e.deep]])},q(R[""+e.deep]),3)]),f("iconpark-icon",{class:"close","icon-id":"tongyiconguanb01",color:"#fff",size:"1rem",onClick:t=>(e=>{ct.value=ct.value.filter((t=>t.id!=e.id))})(e)},null,8,xe)])))),128))]),f("div",Me,[x((L(),T(p,{height:"44px",width:"140px",class:"submit cancel",onClick:dt},{default:k((()=>[z("取消")])),_:1})),[[U]]),x((L(),T(p,{height:"44px",width:"140px",class:"submit",onClick:vt},{default:k((()=>[z("保存")])),_:1})),[[U]])])])])):(L(),h("div",Te,[f("div",ze,[y(u,{modelValue:at.value,"onUpdate:modelValue":l[6]||(l[6]=e=>at.value=e),placeholder:"输入对话名称查询..."},{left:k((()=>[De])),_:1},8,["modelValue"]),f("div",He,[(L(!0),h(_,null,b(S.chatitemList,((e,t)=>(L(),h("div",{class:w(["chatlist",{selected:pt(e)}]),key:t,onClick:t=>(e=>{ct.value.find((t=>t.id===e.id))?ct.value=ct.value.filter((t=>t.id!=e.id)):ct.value.push(e)})(e)},[f("div",Se,[f("img",{class:"item_img",src:`/imgs/head_icons/${e.THeadPhoto}.webp`,alt:""},null,8,Ge),f("div",$e,q(e.TUsername),1)]),f("div",{class:w(["indent_type",["type"+e.deep]])},q(R[""+e.deep]),3)],10,Re)))),128))]),f("div",Ue,[x((L(),T(p,{height:"44px",width:"140px",class:"submit cancel",onClick:ut},{default:k((()=>[z("取消")])),_:1})),[[U]]),x((L(),T(p,{height:"44px",width:"140px",class:"submit",onClick:l[7]||(l[7]=e=>{ot.value=2})},{default:k((()=>[z("保存")])),_:1})),[[U]])])])]))])),_:1},8,["visible","title"]),y(m,{overlay:!1,visible:mt.value,"onUpdate:visible":l[10]||(l[10]=e=>mt.value=e)},{default:k((()=>[f("div",{class:"popup_box",onClick:D(bt,["stop"])},[f("div",{class:"popup_list",onClick:l[9]||(l[9]=D((()=>{}),["stop"]))},[(L(!0),h(_,null,b(yt.value,((e,t)=>(L(),h("div",{class:w(["item",kt.value==t?"active":""]),key:t,onClick:e=>(e=>{kt.value=e,console.log(1,S.chatitemList,gt.value);let t=S.chatitemList[gt.value];switch(t.groupid=S.groupList[et.value]?.id,e){case 0:t.istop=1===t.istop?6:1,Ze(t);break;case 1:Ze(t);break;case 2:t.enableflag=7===t.enableflag?t.enableflag:7,Ze(t);break;case 3:_t.value=!_t.value}})(t)},[f("div",Ve,q(e.title),1),f("iconpark-icon",{class:"close","icon-id":e.icon,color:"#fff",size:"1rem"},null,8,Ee)],10,je)))),128)),x(f("div",Oe,[(L(!0),h(_,null,b(S.groupList,((e,t)=>(L(),h("div",{class:w(["item",I(et)==t?"active":""]),key:t,onClick:s=>((e,t)=>{console.log(e);let s=S.chatitemList[gt.value];s.groupid=S.groupList[t]?.id,Ze(s)})(e,t)},q(e.name),11,Pe)))),128))],512),[[H,_t.value]])])])])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-1da6c0d2"]]);export{Ae as default};